# Cargo.toml ä¾èµ–ä¼˜åŒ–å»ºè®®

## ğŸ¯ ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–é¡¹

### 1. Tokio Features ä¼˜åŒ– âš¡

**å½“å‰é…ç½®**ï¼š
```toml
tokio = { version = "1", features = ["full"] }
```

**é—®é¢˜**ï¼š`full` åŒ…å«æ‰€æœ‰ç‰¹æ€§ï¼Œä¼šç¼–è¯‘è®¸å¤šä¸éœ€è¦çš„åŠŸèƒ½ã€‚

**ä¼˜åŒ–å»ºè®®**ï¼š
```toml
tokio = { version = "1", features = [
    "rt-multi-thread",  # å¤šçº¿ç¨‹è¿è¡Œæ—¶ï¼ˆå¿…éœ€ï¼‰
    "macros",           # async/await å®ï¼ˆå¿…éœ€ï¼‰
    "sync",             # åŒæ­¥åŸè¯­ï¼šMutex, RwLock, Semaphore ç­‰
    "time",             # sleep, interval ç­‰æ—¶é—´åŠŸèƒ½
    "io-util",          # AsyncReadExt, AsyncWriteExt ç­‰ IO trait
    "net",              # TcpListener, TcpStream ç­‰ç½‘ç»œåŠŸèƒ½
    "process",          # è¿›ç¨‹ç›¸å…³ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
    "signal",           # ä¿¡å·å¤„ç†ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
    "fs",               # å¼‚æ­¥æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚æœä½¿ç”¨ï¼‰
] }
```

**é¢„ä¼°æå‡**ï¼šç¼–è¯‘æ—¶é—´å‡å°‘ **5-10 ç§’**

---

### 2. ORT (ONNX Runtime) Features ä¼˜åŒ– ğŸš€

**å½“å‰é…ç½®**ï¼š
```toml
ort = { version = "2.0.0-rc.10", features = ["directml", "cuda"] }
```

**é—®é¢˜**ï¼š
- `cuda`: éœ€è¦ CUDA å·¥å…·é“¾ï¼Œç¼–è¯‘æ—¶é—´é•¿
- å¦‚æœä½ çš„å¼€å‘æœºå™¨æ²¡æœ‰ NVIDIA GPU æˆ–ä¸éœ€è¦ CUDAï¼Œå¯ä»¥ç§»é™¤

**ä¼˜åŒ–å»ºè®®**ï¼š

#### æƒ…å†µ Aï¼šä»… Windowsï¼Œä½¿ç”¨ DirectML
```toml
[target.'cfg(windows)'.dependencies]
ort = { version = "2.0.0-rc.10", features = ["directml"] }

[target.'cfg(not(windows))'.dependencies]
ort = { version = "2.0.0-rc.10" }
```

#### æƒ…å†µ Bï¼šå¼€å‘ç”¨ DirectMLï¼Œç”Ÿäº§ç”¨ CUDA
```toml
# å¼€å‘ç¯å¢ƒ
[dependencies]
ort = { version = "2.0.0-rc.10", features = ["directml"] }

# ç”Ÿäº§ç¯å¢ƒï¼ˆé€šè¿‡ feature flag æ§åˆ¶ï¼‰
[features]
cuda = ["ort/cuda"]

# ç„¶ååœ¨æ„å»ºæ—¶ä½¿ç”¨ï¼š
# cargo build --release --features cuda
```

**é¢„ä¼°æå‡**ï¼šç¼–è¯‘æ—¶é—´å‡å°‘ **10-20 ç§’**ï¼ˆå¦‚æœç§»é™¤ CUDAï¼‰

---

### 3. Image Features ä¼˜åŒ– ğŸ–¼ï¸

**å½“å‰é…ç½®**ï¼š
```toml
image = { version = "0.25", features = ["png", "jpeg"] }
```

**çŠ¶æ€**ï¼šâœ… å·²ä¼˜åŒ–ï¼Œä¿æŒä¸å˜

---

### 4. Tracing Features ä¼˜åŒ– ğŸ“

**å½“å‰é…ç½®**ï¼š
```toml
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }
```

**ä¼˜åŒ–å»ºè®®**ï¼š
```toml
tracing = { version = "0.1", default-features = false }
tracing-subscriber = { version = "0.3", default-features = false, features = [
    "env-filter",
    "fmt",      # æ ¼å¼åŒ–è¾“å‡º
    "ansi",     # å½©è‰²è¾“å‡º
] }
```

**é¢„ä¼°æå‡**ï¼šç¼–è¯‘æ—¶é—´å‡å°‘ **2-3 ç§’**

---

## ğŸ“Š ç»¼åˆä¼˜åŒ–å»ºè®®

### ä¼˜åŒ–åçš„å®Œæ•´é…ç½®

```toml
[workspace.dependencies]
serde = { version = "1", features = ["derive"] }
thiserror = "2.0"
tokio = { version = "1", features = [
    "rt-multi-thread",
    "macros",
    "sync",
    "time",
    "io-util",
    "net",
    "fs",
] }
crossbeam-channel = "0.5.15"
image = { version = "0.25", default-features = false, features = ["png", "jpeg"] }
tracing = { version = "0.1", default-features = false }
adb_client = { version = "2.1.18" }

[dependencies]
# ... å…¶ä»–ä¾èµ–ä¿æŒä¸å˜ ...

# ORT ä¼˜åŒ–é…ç½®
[target.'cfg(windows)'.dependencies]
ort = { version = "2.0.0-rc.10", features = ["directml"] }

# æˆ–è€…ä¿ç•™ CUDA ä½†é€šè¿‡ feature flag æ§åˆ¶
[features]
default = []
cuda = ["ort/cuda"]
```

---

## ğŸ” æ£€æŸ¥æ˜¯å¦éœ€è¦æŸä¸ªä¾èµ–

è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ä¾èµ–ä½¿ç”¨æƒ…å†µï¼š

```powershell
# æŸ¥çœ‹æŸä¸ªä¾èµ–è¢«å“ªäº›æ¨¡å—ä½¿ç”¨
cargo tree -i tokio
cargo tree -i ort

# æŸ¥çœ‹æœªä½¿ç”¨çš„ä¾èµ–
cargo install cargo-udeps
cargo +nightly udeps
```

---

## âš¡ ä¼˜åŒ–æ•ˆæœé¢„ä¼°

| ä¼˜åŒ–é¡¹ | é¦–æ¬¡ç¼–è¯‘ | å¢é‡ç¼–è¯‘ | éš¾åº¦ |
|--------|---------|---------|------|
| Tokio features | -10s | -1s | ç®€å• |
| ORT ç§»é™¤ CUDA | -20s | -2s | ç®€å• |
| Tracing features | -3s | -0.5s | ç®€å• |
| **æ€»è®¡** | **-33s** | **-3.5s** | - |

---

## ğŸ¯ å®æ–½æ­¥éª¤

### æ­¥éª¤ 1ï¼šå¤‡ä»½å½“å‰é…ç½®
```powershell
Copy-Item src-tauri\Cargo.toml src-tauri\Cargo.toml.bak
```

### æ­¥éª¤ 2ï¼šä¿®æ”¹ Cargo.toml
åº”ç”¨ä¸Šè¿°ä¼˜åŒ–å»ºè®®

### æ­¥éª¤ 3ï¼šæ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
```powershell
cargo clean
cargo build
```

### æ­¥éª¤ 4ï¼šéªŒè¯åŠŸèƒ½
ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### æ­¥éª¤ 5ï¼šæµ‹è¯•ç¼–è¯‘æ—¶é—´
```powershell
# æµ‹è¯•å¢é‡ç¼–è¯‘
cargo build --timings
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **CUDA ä¾èµ–**ï¼šå¦‚æœç”Ÿäº§ç¯å¢ƒéœ€è¦ CUDAï¼Œå»ºè®®é€šè¿‡ feature flag æ§åˆ¶ï¼Œå¼€å‘ç¯å¢ƒç¦ç”¨
2. **åŠŸèƒ½éªŒè¯**ï¼šä¿®æ”¹ååŠ¡å¿…æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼Œç¡®ä¿æ²¡æœ‰é—æ¼å¿…éœ€çš„ feature
3. **é€æ­¥ä¼˜åŒ–**ï¼šå»ºè®®ä¸€æ¬¡ä¼˜åŒ–ä¸€ä¸ªä¾èµ–ï¼Œä¾¿äºå®šä½é—®é¢˜

---

## ğŸ“ˆ ç›‘æ§å»ºè®®

å®šæœŸæ£€æŸ¥ç¼–è¯‘æ€§èƒ½ï¼š

```powershell
# ç”Ÿæˆç¼–è¯‘æ—¶é—´å›¾è¡¨
cargo build --timings

# æŸ¥çœ‹ sccache å‘½ä¸­ç‡
sccache --show-stats

# æŸ¥çœ‹ä¾èµ–ç¼–è¯‘æ—¶é—´
cargo tree --depth 1 | Measure-Object
```
