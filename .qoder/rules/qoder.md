---
trigger: manual
---

# 自适应ai安卓游戏辅助
* 描述: 
    * 以游戏脚本-设备-账号为中心。运行脚本时以设备-脚本-账号为key存储运行记录; 
    * 运行时, 以设备为单位, 启动对应数量的子进程, 通过环境变量发送部分数据、内存共享读取模型, 使用ort推理模型, 运行脚本。
    * 运行时, 通过视觉服务（模板匹配/Yolo检测/ocr）识别屏幕内容并自适应做出决策。
* 目标人群: 普通用户、高级（开发者）用户

# 生成代码时注意的点
## 思考当前编码目标外, 你需要根据情况整体考虑思考的内容深度: 
* 该模块/代码的作用
* 该模块/代码在整个项目中的作用
* 该模块/代码与其他模块/代码的关联关系（如根据情况, 自己决定思考深度, 如yolo检测, 关联yolo设置, 关联脚本设置, 关联脚本从文件读取）

## 项目新文件规则
* 模块文件: 采用模块名称+模块名称对应文件夹的方式。比如截图模块则为capture.rs和capture文件夹, 不要采用mod.rs的方式。
* 特性文件: 若模块使用了trait, 则以模块_trait.rs方式, 或base_trait.rs命名, 放在模块文件夹下, 在上诉规则里就是capture文件夹下。
* 错误文件: 模块的错误枚举以模块_error.rs命名, 放在模块文件夹下, 在上诉规则里就是capture文件夹下。
* 返回结果: 以模块Result方式命名, 放在和错误枚举类一个文件里。在上诉规则里就是pub type CapResult<T> = Result<T, CapError>;或CaptureResult
* 返回结果转换: 错误在app层需要转换为AppResult。在api层要转换为ApiResponse<T>类型, 以方便前端展示。
* 数据保存相关: 主进程要保存的运行时数据, 一般保存在app_handel的state里, 子进程一般保存在全局变量里。

## 项目模块说明（基本都是后端部分、基础设施层部分）
* capture模块: 完成窗口截图。adb截图未完成(adb_cli_local模块)。
* config模块: 完成通知设置、系统设置、快捷键设置、设备设置、脚本设置（脚本所在文件夹）的配置和加载
* context模块: 主进程、子进程的上下文都在其中。
* core模块: 设置子进程的线程亲和性（由用户在设备设置里配置）。
* device模块: 设备模块。设备信息的配置、连接都在这里。（目前主要的设备是安卓模拟器、真机, 后续再考虑应用程序）
* hash_calculated: hash计算模块, 用处是在用户下载模型时, 用来比较下载的文件是否完整。
* image模块: 图像处理模块。图像压缩方式、图像裁剪、加载、保存图像。
* ipc模块: 负责主、子进程的通信功能。主进程创建socket, 保留发送的socket, 接收则用tokio任务处理子进程发送过来的内容, 子进程连接并采用mpsc模块发送数据、接收数据。
* logging模块: 主、子进程的日志都在这里。另外子进程通过ipc发送日志
* ort模块: ort执行器的管理
* path_resolve: 路径处理模块。在dev测试页面, 路径是完整路径（用户选择）, 开发者用户开发脚本时, 设置内置模型则是程序内置resource路径, 设置自定义模型则是相对于该脚本的路径
* process模块: 历史代码, 暂无用
* script模块: 脚本相关模块。数据似乎有四种: 
    * 对于普通用户: 1、脚本元素据: 脚本列表页展示; 2、单个脚本的完整数据: 单击某个脚本时展示所有设置、任务等; 
    * 对于开发者用户: 1、展示该脚本的所有数据(编辑方式) ; 
    * 运行时数据: 将脚本设置、用户的设置、规则等关联起来, 在运行时使用。
* vision模块: 视觉处理模块。目标检测、文字检测、文字识别都在此进行。另外, 文字检测使用Yolo时, 支持开发者用户设置文字的标签ID, 以此区分文字和其他目标。

## 项目依赖相关
* 如果需要依赖三方的包, 请先查看本项目依赖中是否包含类似功能的模块, 并优先使用它. 如果不包含, 请先按功能实现、受欢迎程度优先级来添加新的依赖.

## mcp工具
* 请注意时刻关注context7工具, 以保证你生成代码时使用的方法是较新的.